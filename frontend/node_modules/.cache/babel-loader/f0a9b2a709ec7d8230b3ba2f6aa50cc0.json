{"ast":null,"code":"import _classCallCheck from\"/home/vanine/Desktop/maps/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/vanine/Desktop/maps/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/vanine/Desktop/maps/frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/vanine/Desktop/maps/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/vanine/Desktop/maps/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import'antd/dist/antd.css';import axios from'axios';import{Form,Input,Button,Select,InputNumber,Upload,Icon,message}from'antd';import{connect}from\"react-redux\";import{addPoint as _addPoint}from'../actions/addpoint';import{setPoints as _setPoints}from'../actions/setpoints';import{updatePoint as _updatePoint}from'../actions/updatepoint';import FormItem from'antd/lib/form/FormItem';var Option=Select.Option;var TextArea=Input.TextArea;var AddProblemForm=/*#__PURE__*/function(_React$Component){_inherits(AddProblemForm,_React$Component);function AddProblemForm(props){var _this;_classCallCheck(this,AddProblemForm);_this=_possibleConstructorReturn(this,_getPrototypeOf(AddProblemForm).call(this,props));_this.state={confirmDirty:false,autoCompleteResult:[],selectedFile:null};_this.onChangeHandler=function(event){console.log(\"hdgdfgfgdfgsfd\");console.log(event.target.files[0]);_this.setState({selectedFile:event.target.files[0],loaded:0});};_this.handleSubmit=function(e){e.preventDefault();_this.props.form.validateFieldsAndScroll(function(err,values){if(!err){var data=new FormData();data.append('file',_this.state.selectedFile);console.log(_this.state.selectedFile);console.log('data: ',data);var newProblem={category:values.category,longitude:values.longitude,latitude:values.latitude,description:values.description,image:data};var newPoint={latitude:values.latitude,longitude:values.longitude};console.log(newProblem);fetch(\"http://localhost:3001/add_problem\",{method:'POST',body:JSON.stringify(newProblem),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(function(response){return response.json();}).then(function(resp){console.log('response: ',resp);axios({method:'post',url:\"http://localhost:3001/upload_file/\".concat(resp.id),data:data}).then(function(response){console.log(response);});}).then(function(){fetch(\"http://localhost:3001/add_point\",{method:'POST',body:JSON.stringify(newPoint),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(function(res){console.log(\"resp: \",res);if(res.status===200){_this.props.addPoint(newPoint);}else if(res.status===201){_this.props.updatePoint(newPoint);}res.json();}).then(function(res){console.log('response: ',res);}).then(function(){console.log(\"jdgfhdghfd\");});}).catch(function(error){return console.log('error:',error);});}_this.props.form.resetFields();});};_this.handleChange=function(value){console.log(\"selected \".concat(value));};_this.handleConfirmBlur=function(e){var value=e.target.value;_this.setState({confirmDirty:_this.state.confirmDirty||!!value});};_this.fileInput=React.createRef();return _this;}_createClass(AddProblemForm,[{key:\"render\",value:function render(){var props={name:'file',action:'http://localhost:3001/add_image',headers:{authorization:'authorization-text'},onChange:function onChange(info){if(info.file.status!=='uploading'){console.log(info.file,info.fileList);}if(info.file.status==='done'){message.success(\"\".concat(info.file.name,\" file uploaded successfully\"));}else if(info.file.status==='error'){message.error(\"\".concat(info.file.name,\" file upload failed.\"));}}};var getFieldDecorator=this.props.form.getFieldDecorator;var formStyle={marginLeft:'20%',marginTop:'3%',width:'50%'};var formItemLayout={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}};var tailFormItemLayout={wrapperCol:{xs:{span:24,offset:0},sm:{span:16,offset:8}}};return React.createElement(Form,Object.assign({},formItemLayout,{onSubmit:this.handleSubmit,className:\"form\",style:formStyle}),React.createElement(Form.Item,{label:React.createElement(\"span\",null,\"Category\")},getFieldDecorator('category',{initialValue:'Garbage disposal is not done on time'})(React.createElement(Select,{style:{width:'100%'},onChange:this.handleChange},React.createElement(Option,{value:\"0\"},\"Garbage disposal is not done on time\"),React.createElement(Option,{value:\"1\"},\"Trash has no lid\"),React.createElement(Option,{value:\"2\"},\"Trash is placed in the wrong place\")))),React.createElement(Form.Item,{label:\"Latitude\"},getFieldDecorator('latitude',{rules:[{validator:function validator(rule,value,callback){if(!value){callback('Latitude is required');return;}if(value>85||value<-85){callback('Invalid value!');return;}if(typeof value!=='number'){callback('Latitude is not a number');return;}else{callback();}}}]})(React.createElement(InputNumber,{style:{width:'100%'}}))),React.createElement(Form.Item,{label:\"Longitude\"},getFieldDecorator('longitude',{rules:[{validator:function validator(rule,value,callback){if(!value){callback('Longitude is required');return;}if(value>180||value<-180){callback('Invalid value!');return;}if(typeof value!=='number'){callback('Longitude is not a number');return;}else{callback();}}}]})(React.createElement(InputNumber,{style:{width:'100%'}}))),React.createElement(Form.Item,{label:\"Description\"},getFieldDecorator('description',{rules:[{type:'string'},{min:20,message:'Must contain at least 20 letters!'},{max:300,message:'Must contain at most 300 letters!'}]})(React.createElement(TextArea,{rows:3}))),React.createElement(FormItem,{label:\"Image\"},getFieldDecorator('file',{})(React.createElement(Input,{type:\"file\",name:\"file\",onChange:this.onChangeHandler,ref:this.fileInput}))),React.createElement(Form.Item,tailFormItemLayout,React.createElement(Button,{type:\"primary\",htmlType:\"submit\"},\"Add\")));}}]);return AddProblemForm;}(React.Component);var WrappedAddProblemForm=Form.create({name:'register'})(AddProblemForm);export default connect(function(state){return{points:state.points};},function(dispatch){return{addPoint:function addPoint(data){dispatch(_addPoint(data));},setPoints:function setPoints(data){dispatch(_setPoints(data));},updatePoint:function updatePoint(data){dispatch(_updatePoint(data));}};})(WrappedAddProblemForm);","map":{"version":3,"sources":["/home/vanine/Desktop/maps/frontend/src/components/addProblem.js"],"names":["React","axios","Form","Input","Button","Select","InputNumber","Upload","Icon","message","connect","addPoint","setPoints","updatePoint","FormItem","Option","TextArea","AddProblemForm","props","state","confirmDirty","autoCompleteResult","selectedFile","onChangeHandler","event","console","log","target","files","setState","loaded","handleSubmit","e","preventDefault","form","validateFieldsAndScroll","err","values","data","FormData","append","newProblem","category","longitude","latitude","description","image","newPoint","fetch","method","body","JSON","stringify","headers","then","response","json","resp","url","id","res","status","catch","error","resetFields","handleChange","value","handleConfirmBlur","fileInput","createRef","name","action","authorization","onChange","info","file","fileList","success","getFieldDecorator","formStyle","marginLeft","marginTop","width","formItemLayout","labelCol","xs","span","sm","wrapperCol","tailFormItemLayout","offset","initialValue","rules","validator","rule","callback","type","min","max","Component","WrappedAddProblemForm","create","points","dispatch"],"mappings":"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","sourcesContent":["import React from 'react';\nimport 'antd/dist/antd.css';\nimport axios from 'axios';\nimport { Form, Input, Button, Select, InputNumber, Upload, Icon, message } from 'antd';\nimport { connect } from \"react-redux\";\nimport { addPoint } from '../actions/addpoint';\nimport { setPoints } from '../actions/setpoints';\nimport { updatePoint } from '../actions/updatepoint';\nimport FormItem from 'antd/lib/form/FormItem';\nconst { Option } = Select;\nconst { TextArea } = Input;\n\nclass AddProblemForm extends React.Component {\n    state = {\n      confirmDirty: false,\n      autoCompleteResult: [],\n      selectedFile: null,\n    };\n    constructor(props) {\n      super(props);\n      this.fileInput = React.createRef();\n    }\n    onChangeHandler = event => {\n      console.log(\"hdgdfgfgdfgsfd\");\n      console.log(event.target.files[0]);\n      this.setState({\n        selectedFile: event.target.files[0],\n        loaded: 0,\n      })\n    }\n    handleSubmit = e => {\n      e.preventDefault();\n      this.props.form.validateFieldsAndScroll((err, values) => {\n        if (!err) {\n          const data = new FormData() \n          data.append('file', this.state.selectedFile);\n          console.log(this.state.selectedFile);\n          console.log('data: ', data);\n          const newProblem = {\n            category: values.category,\n            longitude: values.longitude,\n            latitude: values.latitude,\n            description: values.description,\n            image: data\n        };\n          const newPoint = {\n            latitude: values.latitude,\n            longitude: values.longitude\n          }\n        console.log(newProblem);\n        \n\n        fetch(\"http://localhost:3001/add_problem\", {\n            method: 'POST',\n            body: JSON.stringify(newProblem),\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded',\n                },\n        }).then(response => response.json())\n        .then(resp => {console.log('response: ', resp);\n        axios({\n          method: 'post',\n          url: `http://localhost:3001/upload_file/${resp.id}`,\n          data: data,\n        }).then(response => {\n          console.log(response);\n        })\n      })\n        .then(() => {\n        fetch(\"http://localhost:3001/add_point\", {\n          method: 'POST',\n          body: JSON.stringify(newPoint),\n          headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              },\n        }).then(res => {\n          console.log(\"resp: \", res);\n          if(res.status === 200) {\n            this.props.addPoint(newPoint);\n          }\n          else if(res.status === 201) {\n            this.props.updatePoint(newPoint);\n          }\n          res.json()})\n        .then(res => {console.log('response: ', res)})\n        .then(() => {\n          console.log(\"jdgfhdghfd\");\n        })\n      })\n        .catch(error => console.log('error:', error));\n      }\n      this.props.form.resetFields();\n      })};\n\n    handleChange = (value) => {\n        console.log(`selected ${value}`);\n    };\n\n    handleConfirmBlur = e => {\n      const { value } = e.target;\n      this.setState({ confirmDirty: this.state.confirmDirty || !!value });\n    };\n    \n    render() {\n      \n      const props = {\n        name: 'file',\n        action: 'http://localhost:3001/add_image',\n        headers: {\n          authorization: 'authorization-text',\n        },\n        onChange(info) {\n          if (info.file.status !== 'uploading') {\n            console.log(info.file, info.fileList);\n          }\n          if (info.file.status === 'done') {\n            message.success(`${info.file.name} file uploaded successfully`);\n          } else if (info.file.status === 'error') {\n            message.error(`${info.file.name} file upload failed.`);\n          }\n        },\n      };\n      const { getFieldDecorator } = this.props.form;\n      const formStyle = {\n          marginLeft: '20%',\n          marginTop: '3%',\n          width: '50%'\n      }\n  \n      const formItemLayout = {\n        labelCol: {\n          xs: { span: 24 },\n          sm: { span: 8 },\n        },\n        wrapperCol: {\n          xs: { span: 24 },\n          sm: { span: 16 },\n        },\n      };\n      const tailFormItemLayout = {\n        wrapperCol: {\n          xs: {\n            span: 24,\n            offset: 0,\n          },\n          sm: {\n            span: 16,\n            offset: 8,\n          },\n        },\n      };\n       return (\n        <Form {...formItemLayout} onSubmit={this.handleSubmit} className='form' style={formStyle}>\n             <Form.Item label={<span>Category</span>}>\n             {getFieldDecorator('category', {\n                initialValue: 'Garbage disposal is not done on time'\n            })(<Select style={{ width: '100%' }} onChange={this.handleChange}>\n                <Option value=\"0\">Garbage disposal is not done on time</Option>\n                <Option value=\"1\">Trash has no lid</Option>\n                <Option value=\"2\">Trash is placed in the wrong place</Option>\n            </Select>)}\n          </Form.Item>\n          <Form.Item label=\"Latitude\">\n            {getFieldDecorator('latitude', {\n              rules: [\n                {\n                  validator(rule, value, callback) {\n                    if(!value) {\n                      callback('Latitude is required');\n                      return;\n                    }\n                    if(value > 85 || value < -85) {\n                      callback('Invalid value!');\n                      return;\n                    }\n                    if(typeof(value) !== 'number') {\n                      callback('Latitude is not a number');\n                      return;\n                    }\n                    else {\n                      callback();\n                    }\n                  } \n                },\n              ],\n            })(<InputNumber style={{width: '100%'}} />)}\n          </Form.Item>\n          <Form.Item label=\"Longitude\">\n            {getFieldDecorator('longitude', {\n              rules: [\n                {\n                  validator(rule, value, callback) {\n                    if(!value) {\n                      callback('Longitude is required');\n                      return;\n                    }\n                    if(value > 180 || value < -180) {\n                      callback('Invalid value!');\n                      return;\n                    }\n                    if(typeof(value) !== 'number') {\n                      callback('Longitude is not a number');\n                      return;\n                    }\n                    else {\n                      callback();\n                    }\n                  } \n                },\n              ],\n            })(<InputNumber style={{width: '100%'}}/>)}\n          </Form.Item>   \n          <Form.Item label=\"Description\">\n            {getFieldDecorator('description', {\n              rules: [\n                {\n                  type: 'string',\n                },\n                {\n                  min: 20,\n                  message: 'Must contain at least 20 letters!',\n                },\n                {\n                  max: 300,\n                  message: 'Must contain at most 300 letters!',\n                }\n              ],\n            })(<TextArea rows={3} />)}\n          </Form.Item>  \n          <FormItem label='Image'>\n          {getFieldDecorator('file', {\n            })(<Input type='file' name = 'file' onChange={this.onChangeHandler} ref={this.fileInput}/>)}          \n            </FormItem>   \n         <Form.Item {...tailFormItemLayout}>\n            <Button type=\"primary\" htmlType=\"submit\">\n              Add\n            </Button>\n          </Form.Item>\n        </Form>\n      );\n    }\n  }\n  \nconst WrappedAddProblemForm = Form.create({ name: 'register' })(AddProblemForm);\nexport default connect(\n  state => ({\n    points: state.points,\n    }),\n  dispatch => ({\n    addPoint: (data => {\n      dispatch(addPoint(data))\n    }),\n    setPoints: ((data) => {\n      dispatch(setPoints(data))\n    }),\n    updatePoint: ((data) => {\n      dispatch(updatePoint(data))\n    }),\n}))(WrappedAddProblemForm);"]},"metadata":{},"sourceType":"module"}